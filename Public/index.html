<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <!--指定螢幕寬度為裝置寬度，畫面載入初始縮放比例 100%-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portfolio</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!--使用leaflet會做出像google map那樣可以拖動縮放的地圖-->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!--導入google fonts的字體，讓網頁可以使用Poppins跟DM Serif Display這兩種字型-->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">

  <!--用gsap控制動畫-->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>
  
  <!--css-->
  <link rel="stylesheet" href="stylee.css" />
</head>

<body>
  <!--這一段是首頁，section用來把網頁分成一段一段的，div區塊用來將網頁內容分組、劃分區域，class和id取名，alt是如果圖片沒有出現會留下的文字說明-->
  <section class="cover" id="home">
    <div class="cover-wrap">
      <img class="cover-bg" src="imgg/cover-bg4.jpg" alt="cover background">

      <img class="cover-tree cover-tree--left" src="imgg/tree-left.png" alt="left tree">
      <img class="cover-tree cover-tree--right" src="imgg/tree-left.png" alt="right tree">

      <img class="cover-center" src="imgg/new.png" alt="center asset">

      <div class="cover-title">
        <h1 class="cover-title__text m-0">Hello world!</h1>
      </div>
    </div>
  </section>

  <!--這一段是快速作品瀏覽，當滑鼠滾動時，作品會往左滑動，container置中且左右留白，row一個橫向的空間，讓裡面的col能夠在其中排成一行，col-12滿版-->
  <section class="quick" id="works">
    <div class="container">
      <div class="row">
        <div class="col-12">

          <div class="quick-list">
            <a class="quick-card" href="#"><img src="imgg/pic1.jpg" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic2.png" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic3.jpg" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic4.png" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic5.JPG" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic6.png" alt=""></a>
          </div>

          <div class="quick-caption text-center mt-4">
            <div class="quick-title reveal-text">Showcase</div>
            <div class="quick-sub reveal-text">下面還有</div>
          </div>

        </div>
      </div>
    </div>
  </section>


  <!--這一段是簡單的自我介紹，還有放上星星和愛心裝飾-->
  <section class="about" id="about">
    <div class="about-deco">
      <img class="about-deco__item about-deco__item--1" src="imgg/pic33.png" alt="">
      <img class="about-deco__item about-deco__item--2" src="imgg/pic34.png" alt="">
    </div>

    <div class="container">
      <div class="row g-4 align-items-center">
        <div class="col-12 col-lg-5">
          <div class="about-text">
            <h2 class="reveal-text mb-3">ABOUT ME</h2>
            <p class="reveal-text mb-2">嗨，我是 Tso Ling Yu，目前就讀國立臺中科技大學多媒體設計系。</p>
            <p class="reveal-text mb-0">熟悉 Figma、InDesign、AE、Premiere、Maya。</p>
          </div>
        </div>

        <div class="col-12 col-lg-7">
          <div class="about-img">
            <img src="imgg/img2.JPG" alt="about photo">
          </div>
        </div>
      </div>
    </div>
  </section>


  <!--這一段是重要作品展示，作品會往左邊水平移動-->
  <section class="works" id="worksMain">
    <div class="works-track">
      <a class="work-slide" href="#"><img src="imgg/pic30.png" alt=""></a>
      <a class="work-slide" href="#"><img src="imgg/pic29.png" alt=""></a>
      <a class="work-slide" href="#"><img src="imgg/pic32.png" alt=""></a>
      <a class="work-slide" href="#"><img src="imgg/pic27.png" alt=""></a>
    </div>
  </section>


  <!--放上我喜歡的電影名言:勇氣不是沒有恐懼，而是戰勝恐懼-->
  <section class="quote" id="quote">
    <div class="quote-wrap container">
      <h2 class="quote-line quote-line--1" data-text="Courage is not the absence of fear,"></h2>
      <h2 class="quote-line quote-line--2" data-text="but the triumph over it."></h2>
    </div>
  </section>


  <!--左邊是leaflet地圖，右邊是vue表單，送出後會到後端資料庫-->
  <section class="contact" id="contact">
    <div class="container">
      <div class="row g-4 align-items-start">

        <div class="col-12 col-lg-6">
          <h2 class="contact-title reveal-text mb-3">CONNECT ME</h2>
          <div id="map" class="contact-map"></div>
        </div>

        <div class="col-12 col-lg-6">
          <div id="app">
            <form @submit.prevent="send" class="d-grid gap-3">
              <input class="form-control" type="email" placeholder="Email" v-model="form.email" required>
              <input class="form-control" type="text" placeholder="Phone" v-model="form.phone">
              <input class="form-control" type="text" placeholder="Name" v-model="form.name">
              <textarea class="form-control" rows="6" placeholder="Message" v-model="form.message"></textarea>
              <button class="btn btn-lg btn-send" type="submit">Send</button>
            </form>
            <!--顯示是否送出成功-->
            <p v-if="msg" class="saveMsg mt-3">{{ msg }}</p>
          </div>
        </div>

      </div>
    </div>
  </section>


  <!--頁角，有我的名字、書籤、社群軟體的icon-->
  <footer class="site-footer">
    <div class="container">
      <div class="d-flex flex-column flex-lg-row align-items-center justify-content-between gap-4 text-center text-lg-start">

        <div class="footer-brand d-flex align-items-center gap-3 justify-content-center justify-content-lg-start w-100 w-lg-auto">
          <div class="footer-logo" aria-hidden="true"></div>
          <div class="footer-name">Tso Ling Yu</div>
        </div>

        <div class="footer-right d-flex flex-column flex-lg-row align-items-center gap-3 gap-lg-4 w-100 w-lg-auto">
          <nav class="footer-nav">
            <a href="#home">Home</a>
            <a href="#works">Works</a>
            <a href="#about">About</a>
            <a href="#contact">Contact</a>
          </nav>

          <!--icon用svg畫出來-->
          <div class="footer-social d-flex gap-2 justify-content-center">
            <a href="#" aria-label="Instagram" class="icon-btn">
              <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
                <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4a6 6 0 1 1 0 12a6 6 0 0 1 0-12zm0 2a4 4 0 1 0 0 8a4 4 0 0 0 0-8zm6.5-.6a1.1 1.1 0 1 1-2.2 0a1.1 1.1 0 0 1 2.2 0z"/>
              </svg>
            </a>

            <a href="#" aria-label="X" class="icon-btn">
              <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
                <path fill="currentColor" d="M18.9 2H22l-6.8 7.8L23 22h-6.5l-5.1-6.4L5.7 22H2l7.3-8.4L1 2h6.6l4.6 5.8L18.9 2zm-1.1 18h1.7L7.5 3.9H5.7L17.8 20z"/>
              </svg>
            </a>

            <a href="#" aria-label="YouTube" class="icon-btn">
              <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
                <path fill="currentColor" d="M21.6 7.2a3 3 0 0 0-2.1-2.1C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.5A3 3 0 0 0 2.4 7.2A31 31 0 0 0 2 12a31 31 0 0 0 .4 4.8a3 3 0 0 0 2.1 2.1c1.8.5 7.5.5 7.5.5s5.7 0 7.5-.5a3 3 0 0 0 2.1-2.1A31 31 0 0 0 22 12a31 31 0 0 0-.4-4.8zM10 15.5v-7l6 3.5-6 3.5z"/>
              </svg>
            </a>
          </div>
        </div>

      </div>
    </div>
  </footer>


  <!--載入套件-->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    //告訴gsap等下會用到scrolltrigger這個外掛
    gsap.registerPlugin(ScrollTrigger);

    //地圖leaflet
    window.addEventListener("load", () => {
      //setview經緯度
      const map = L.map("map").setView([24.1503, 120.6839], 13);
      //地圖底圖
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);
      //標記位置
      L.marker([24.1503, 120.6839]).addTo(map).bindPopup("me");
      //用invalidatesize讓leaflet重新計算地圖大小，避免地圖顯示的不完整
      setTimeout(() => map.invalidateSize(), 200);
    });


    //快速作品展示加滑鼠滾動
    const quickList = document.querySelector(".quick-list");
    //判斷是否出現在畫面上大於60%，避免被攔截
    function isInViewEnough(el) {
      const r = el.getBoundingClientRect();
      const vh = window.innerHeight;
      //意思是這個元素大部分已經出現在畫面中了，可以觸發效果
      const visible = Math.min(r.bottom, vh) - Math.max(r.top, 0);
      const ratio = visible / r.height;
      return ratio >= 0.6;
    }

    window.addEventListener("wheel", (e) => {
      if (!quickList) return;
      if (!isInViewEnough(quickList)) return;

      //調整速度
      const SPEED = 9;
      //最右邊能滑到的極限
      const maxScrollLeft = quickList.scrollWidth - quickList.clientWidth;
      const atStart = quickList.scrollLeft <= 0;
      const atEnd = quickList.scrollLeft >= maxScrollLeft - 1;

      //goingright=e.deltay>0代表往右滑
      const goingRight = e.deltaY > 0;
      const goingLeft = e.deltaY < 0;

      //只有在還能左右滑動時，才攔截預設滾動，避免整頁被卡住
      const canScrollHorizontally =
        (goingRight && !atEnd) || (goingLeft && !atStart);

      if (canScrollHorizontally) {
        e.preventDefault();
        quickList.scrollLeft += e.deltaY * SPEED;
      }
    }, { passive: false });



    //about me裡的裝飾會往上移動
    const aboutSection = document.querySelector(".about");
    function updateAboutDeco() {
      if (!aboutSection) return;

      const r = aboutSection.getBoundingClientRect();
      const vh = window.innerHeight;

      const start = vh;
      const end = -r.height;
      const t = (start - r.top) / (start - end);
      const progress = Math.max(0, Math.min(1, t));

      //位移
      const y1 = (1 - progress) * 280;
      const y2 = (1 - progress) * 220;

      const i1 = aboutSection.querySelector(".about-deco__item--1");
      const i2 = aboutSection.querySelector(".about-deco__item--2");

      if (i1) i1.style.setProperty("--aboutY", `${y1}px`);
      if (i2) i2.style.setProperty("--aboutY", `${y2}px`);
    }
    window.addEventListener("scroll", updateAboutDeco, { passive: true });
    window.addEventListener("resize", updateAboutDeco);
    updateAboutDeco();



    //滾動式差在這裡
    const coverTL = gsap.timeline({
      scrollTrigger: {
        //trigger呼叫cover觸發區塊
        trigger: ".cover",
        //cover碰到視窗頂端時開始控制動畫
        start: "top top",
        //讓這段動畫需要滾動90%的距離才跑完
        end: "+=90%",
        //滾多少跑多少
        scrub: true,
        //pin固定畫面用的
        pin: true,
        //anticipatepin讓pin在切換的時候不會跳
        anticipatePin: 1
      }
    });
    //樹往左右角落跑
    coverTL.to(".cover-tree--left",  { x: -350, y: 300 }, 0);
    coverTL.to(".cover-tree--right", { x:  350, y: 300 }, 0);
    //放大
    coverTL.to(".cover-center",      { scale: 1.5 }, 0);
    coverTL.to(".cover-bg",          { scale: 1.2 }, 0);
    //透明度從0變1，如果要讓字從小變大就用scale
    coverTL.to(".cover-title",       { opacity: 1 }, 0);




    //showcass字的出現效果
    gsap.utils.toArray(".reveal-text").forEach((el) => {
      gsap.to(el, {
        opacity: 1,
        y: 0,
        ease: "power2.out",
        scrollTrigger: {
          trigger: el,
          start: "top 70%",
          end: "top 10%",
          scrub: true
        }
      });
    });



    //about裡的照片做出場彈跳效果
    (() => {
      const mq = window.matchMedia("(min-width: 992px)");
      const img = document.querySelector(".about-img img");
      if (!img) return;

      const setup = () => {
        ScrollTrigger.getAll().forEach(st => {
          if (st && st.vars && st.vars.id === "aboutBounce") st.kill();
        });
        gsap.killTweensOf(img);

        //螢幕小時不做彈跳效果
        if (!mq.matches) return;

        gsap.set(img, { transformOrigin: "50% 50%" });

        ScrollTrigger.create({
          id: "aboutBounce",
          trigger: ".about-img",
          start: "top 70%",
          once: true,
          onEnter: () => {
            gsap.fromTo(img,
              { opacity: 0, y: 80, scale: 0.2 },
              {
                opacity: 1,
                y: 0,
                scale: 1,
                duration: 0.35,
                //bake彈性
                ease: "back.out(2.6)",
                overwrite: true,
                onComplete: () => {
                  //keyframe進入後再做一個小小的彈跳
                  gsap.to(img, {
                    keyframes: [
                      { scale: 1.10, duration: 0.14, ease: "power2.out" },
                      { scale: 0.97, duration: 0.12, ease: "power2.inOut" },
                      { scale: 1.04, duration: 0.12, ease: "power2.out" },
                      { scale: 1.00, duration: 0.10, ease: "power2.inOut" }
                    ],
                    overwrite: true
                  });
                }
              }
            );
          }
        });

        ScrollTrigger.refresh();
      };

      window.addEventListener("load", setup);
      window.addEventListener("resize", setup);
    })();




    //重要作品瀏覽，螢幕小就正常往下排列
    const worksSection = document.querySelector(".works");
    const worksTrack = document.querySelector(".works-track");

    function setupWorksScroll() {
      ScrollTrigger.getAll().forEach(st => {
        if (st && st.vars && st.vars.id === "worksPin") st.kill();
      });
      if (worksTrack) gsap.killTweensOf(worksTrack);

      if (!worksSection || !worksTrack) return;

      const isDesktop = window.matchMedia("(min-width: 768px)").matches;

      if (!isDesktop) {
        worksTrack.style.transform = "none";
        worksSection.style.height = "auto";
        return;
      }

      //最大可移動距離
      const maxX = () => -(worksTrack.scrollWidth - window.innerWidth);

      gsap.to(worksTrack, {
        x: maxX,
        ease: "none",
        scrollTrigger: {
          id: "worksPin",
          trigger: worksSection,
          start: "top top",
          end: () => "+=" + (worksTrack.scrollWidth - window.innerWidth),
          scrub: true,
          pin: true,
          anticipatePin: 1,
          invalidateOnRefresh: true
        }
      });

      ScrollTrigger.refresh();
    }

    window.addEventListener("load", setupWorksScroll);
    window.addEventListener("resize", setupWorksScroll);



    //電影名言進場
    const quoteLines = document.querySelectorAll(".quote-line");
    if (quoteLines.length) {
      gsap.to(quoteLines, {
        scrollTrigger: {
          trigger: ".quote",
          start: "top 80%",
          end: "top 30%",
          scrub: true
        },
        color: "rgba(255,255,255,0.92)",
        filter: "blur(0px)",
        y: 0
      });
    }


    //打字效果
    (() => {
      const sec = document.querySelector(".quote");
      const l1 = document.querySelector(".quote-line--1");
      const l2 = document.querySelector(".quote-line--2");
      if (!sec || !l1 || !l2) return;

      const t1 = l1.dataset.text || "";
      const t2 = l2.dataset.text || "";

      //先清空，等進入畫面才開始打
      l1.textContent = "";
      l2.textContent = "";

      let typed = false;

      const typeLine = (el, text, speed = 22) =>
        new Promise((resolve) => {
          let i = 0;
          const timer = setInterval(() => {
            i++;
            el.textContent = text.slice(0, i);
            if (i >= text.length) {
              clearInterval(timer);
              resolve();
            }
          }, speed);
        });


      //元素進到視窗一定比例就觸發
      const io = new IntersectionObserver(async (entries) => {
        const entry = entries[0];
        if (!entry || !entry.isIntersecting) return;
        if (typed) return;

        typed = true;
        await typeLine(l1, t1, 22);
        await typeLine(l2, t2, 22);
        io.disconnect();
      }, {
        threshold: 0.45,
        rootMargin: "0px 0px -10% 0px"
      });

      io.observe(sec);
    })();
  </script>



  <script>
    //vue，送出後，用fetch把資料送到後端api存進資料庫
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          //表單欄位資料
          form: { email: "", phone: "", name: "", message: "" },
          //畫面提示訊息
          msg: ""
        };
      },
      methods: {
        async send() {
          try {
            this.msg = "Saving...";

            //把表單資料送到後端，render上的伺服器
            const resp = await fetch("https://two025web-5j0h.onrender.com/api/messages", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              //把form物件轉成json字串
              body: JSON.stringify(this.form)
            });

            //後端回傳結果
            const data = await resp.json();

            if (!resp.ok || !data.ok) {
              this.msg = "Save failed";
              return;
            }

            //成功顯示Saved，並清空表單
            this.msg = "Saved!";
            this.form = { email: "", phone: "", name: "", message: "" };
            setTimeout(() => (this.msg = ""), 2000);
          } catch (e) {
            console.error(e);
            this.msg = "Network error";
          }
        }
      }
    }).mount("#app");
  </script>

</body>
</html>