<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portfolio</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/ScrollTrigger.min.js"></script>

  <!-- Your CSS -->
  <link rel="stylesheet" href="stylee.css" />
</head>

<body>

  <!-- A. Cover -->
  <section class="cover" id="home">
    <div class="cover-wrap">
      <img class="cover-bg" src="imgg/cover-bg4.jpg" alt="cover background">

      <img class="cover-tree cover-tree--left" src="imgg/tree-left.png" alt="left tree">
      <img class="cover-tree cover-tree--right" src="imgg/tree-left.png" alt="right tree">

      <img class="cover-center" src="imgg/new.png" alt="center asset">

      <div class="cover-title">
        <h1 class="cover-title__text m-0">Hello world!</h1>
      </div>
    </div>
  </section>

  <!-- B. Quick Browse -->
  <section class="quick" id="works">
    <div class="container">
      <div class="row">
        <div class="col-12">

          <div class="quick-list">
            <a class="quick-card" href="#"><img src="imgg/pic1.jpg" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic2.png" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic3.jpg" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic4.png" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic5.JPG" alt=""></a>
            <a class="quick-card" href="#"><img src="imgg/pic6.png" alt=""></a>
          </div>

          <div class="quick-caption text-center mt-4">
            <div class="quick-title reveal-text">Showcase</div>
            <div class="quick-sub reveal-text">Scroll to skim projects fast</div>
          </div>

        </div>
      </div>
    </div>
  </section>

  <!-- D. About -->
  <section class="about" id="about">
    <div class="about-deco">
      <img class="about-deco__item about-deco__item--1" src="imgg/pic33.png" alt="">
      <img class="about-deco__item about-deco__item--2" src="imgg/pic34.png" alt="">
    </div>

    <div class="container">
      <div class="row g-4 align-items-center">
        <div class="col-12 col-lg-5">
          <div class="about-text">
            <h2 class="reveal-text mb-3">ABOUT ME</h2>
            <p class="reveal-text mb-2">嗨，我是 Tso Ling Yu，目前就讀國立臺中科技大學多媒體設計系。</p>
            <p class="reveal-text mb-0">熟悉 Figma、InDesign、AE、Premiere、Maya。</p>
          </div>
        </div>

        <div class="col-12 col-lg-7">
          <div class="about-img">
            <img src="imgg/img2.JPG" alt="about photo">
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- C. Works -->
  <section class="works" id="worksMain">
    <div class="works-track">
      <a class="work-slide" href="#"><img src="imgg/pic30.png" alt=""></a>
      <a class="work-slide" href="#"><img src="imgg/pic29.png" alt=""></a>
      <a class="work-slide" href="#"><img src="imgg/pic32.png" alt=""></a>
      <a class="work-slide" href="#"><img src="imgg/pic27.png" alt=""></a>
    </div>
  </section>

  <!-- Quote -->
  <section class="quote" id="quote">
    <div class="quote-wrap container">
      <h2 class="quote-line quote-line--1" data-text="Courage is not the absence of fear,"></h2>
      <h2 class="quote-line quote-line--2" data-text="but the triumph over it."></h2>
    </div>
  </section>

  <!-- E. Contact -->
  <section class="contact" id="contact">
    <div class="container">
      <div class="row g-4 align-items-start">

        <div class="col-12 col-lg-6">
          <h2 class="contact-title reveal-text mb-3">CONNECT ME</h2>
          <div id="map" class="contact-map"></div>
        </div>

        <div class="col-12 col-lg-6">
          <!-- Vue mount：保留 #app（不要改） -->
          <div id="app">
            <form @submit.prevent="send" class="d-grid gap-3">
              <input class="form-control" type="email" placeholder="Email" v-model="form.email" required>
              <input class="form-control" type="text" placeholder="Phone" v-model="form.phone">
              <input class="form-control" type="text" placeholder="Name" v-model="form.name">
              <textarea class="form-control" rows="6" placeholder="Message" v-model="form.message"></textarea>
              <button class="btn btn-lg btn-send" type="submit">Send</button>
            </form>

            <p v-if="msg" class="saveMsg mt-3">{{ msg }}</p>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container">
      <div class="d-flex flex-column flex-lg-row align-items-center justify-content-between gap-4 text-center text-lg-start">

        <div class="footer-brand d-flex align-items-center gap-3 justify-content-center justify-content-lg-start w-100 w-lg-auto">
          <div class="footer-logo" aria-hidden="true"></div>
          <div class="footer-name">Tso Ling Yu</div>
        </div>

        <div class="footer-right d-flex flex-column flex-lg-row align-items-center gap-3 gap-lg-4 w-100 w-lg-auto">
          <nav class="footer-nav">
            <a href="#home">Home</a>
            <a href="#works">Works</a>
            <a href="#about">About</a>
            <a href="#contact">Contact</a>
          </nav>

          <div class="footer-social d-flex gap-2 justify-content-center">
            <a href="#" aria-label="Instagram" class="icon-btn">
              <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
                <path fill="currentColor" d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3zm-5 4a6 6 0 1 1 0 12a6 6 0 0 1 0-12zm0 2a4 4 0 1 0 0 8a4 4 0 0 0 0-8zm6.5-.6a1.1 1.1 0 1 1-2.2 0a1.1 1.1 0 0 1 2.2 0z"/>
              </svg>
            </a>

            <a href="#" aria-label="X" class="icon-btn">
              <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
                <path fill="currentColor" d="M18.9 2H22l-6.8 7.8L23 22h-6.5l-5.1-6.4L5.7 22H2l7.3-8.4L1 2h6.6l4.6 5.8L18.9 2zm-1.1 18h1.7L7.5 3.9H5.7L17.8 20z"/>
              </svg>
            </a>

            <a href="#" aria-label="YouTube" class="icon-btn">
              <svg viewBox="0 0 24 24" class="icon" aria-hidden="true">
                <path fill="currentColor" d="M21.6 7.2a3 3 0 0 0-2.1-2.1C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.5A3 3 0 0 0 2.4 7.2A31 31 0 0 0 2 12a31 31 0 0 0 .4 4.8a3 3 0 0 0 2.1 2.1c1.8.5 7.5.5 7.5.5s5.7 0 7.5-.5a3 3 0 0 0 2.1-2.1A31 31 0 0 0 22 12a31 31 0 0 0-.4-4.8zM10 15.5v-7l6 3.5-6 3.5z"/>
              </svg>
            </a>
          </div>
        </div>

      </div>
    </div>
  </footer>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Vue -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

  <!-- Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    gsap.registerPlugin(ScrollTrigger);

    // ===== Leaflet =====
    window.addEventListener("load", () => {
      const map = L.map("map").setView([24.1503, 120.6839], 13);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 19 }).addTo(map);
      L.marker([24.1503, 120.6839]).addTo(map).bindPopup("Ling Yu");
      setTimeout(() => map.invalidateSize(), 200);
    });

    // ===== Quick wheel -> horizontal =====
    const quickList = document.querySelector(".quick-list");

    function isInViewEnough(el) {
      const r = el.getBoundingClientRect();
      const vh = window.innerHeight;
      const visible = Math.min(r.bottom, vh) - Math.max(r.top, 0);
      const ratio = visible / r.height;
      return ratio >= 0.6;
    }

    window.addEventListener("wheel", (e) => {
      if (!quickList) return;
      if (!isInViewEnough(quickList)) return;

      const SPEED = 9;
      const maxScrollLeft = quickList.scrollWidth - quickList.clientWidth;
      const atStart = quickList.scrollLeft <= 0;
      const atEnd = quickList.scrollLeft >= maxScrollLeft - 1;

      const goingRight = e.deltaY > 0;
      const goingLeft = e.deltaY < 0;

      const canScrollHorizontally =
        (goingRight && !atEnd) || (goingLeft && !atStart);

      if (canScrollHorizontally) {
        e.preventDefault();
        quickList.scrollLeft += e.deltaY * SPEED;
      }
    }, { passive: false });

    // ===== About floating deco =====
    const aboutSection = document.querySelector(".about");

    function updateAboutDeco() {
      if (!aboutSection) return;

      const r = aboutSection.getBoundingClientRect();
      const vh = window.innerHeight;

      const start = vh;
      const end = -r.height;
      const t = (start - r.top) / (start - end);
      const progress = Math.max(0, Math.min(1, t));

      const y1 = (1 - progress) * 280;
      const y2 = (1 - progress) * 220;

      const i1 = aboutSection.querySelector(".about-deco__item--1");
      const i2 = aboutSection.querySelector(".about-deco__item--2");

      if (i1) i1.style.setProperty("--aboutY", `${y1}px`);
      if (i2) i2.style.setProperty("--aboutY", `${y2}px`);
    }

    window.addEventListener("scroll", updateAboutDeco, { passive: true });
    window.addEventListener("resize", updateAboutDeco);
    updateAboutDeco();

    // ===== Cover Parallax =====
    const coverTL = gsap.timeline({
      scrollTrigger: {
        trigger: ".cover",
        start: "top top",
        end: "+=90%",
        scrub: true,
        pin: true,
        anticipatePin: 1
      }
    });

    coverTL.to(".cover-tree--left",  { x: -350, y: 300 }, 0);
    coverTL.to(".cover-tree--right", { x:  350, y: 300 }, 0);
    coverTL.to(".cover-center",      { scale: 1.5 }, 0);
    coverTL.to(".cover-bg",          { scale: 1.2 }, 0);
    coverTL.to(".cover-title",       { opacity: 1 }, 0);

    // ===== Reveal =====
    gsap.utils.toArray(".reveal-text").forEach((el) => {
      gsap.to(el, {
        opacity: 1,
        y: 0,
        ease: "power2.out",
        scrollTrigger: {
          trigger: el,
          start: "top 70%",
          end: "top 10%",
          scrub: true
        }
      });
    });

    // ===== About photo bounce (desktop only) =====
    (() => {
      const mq = window.matchMedia("(min-width: 992px)");
      const img = document.querySelector(".about-img img");
      if (!img) return;

      const setup = () => {
        ScrollTrigger.getAll().forEach(st => {
          if (st && st.vars && st.vars.id === "aboutBounce") st.kill();
        });
        gsap.killTweensOf(img);

        if (!mq.matches) return;

        gsap.set(img, { transformOrigin: "50% 50%" });

        ScrollTrigger.create({
          id: "aboutBounce",
          trigger: ".about-img",
          start: "top 70%",
          once: true,
          onEnter: () => {
            gsap.fromTo(img,
              { opacity: 0, y: 80, scale: 0.2 },
              {
                opacity: 1,
                y: 0,
                scale: 1,
                duration: 0.35,
                ease: "back.out(2.6)",
                overwrite: true,
                onComplete: () => {
                  gsap.to(img, {
                    keyframes: [
                      { scale: 1.10, duration: 0.14, ease: "power2.out" },
                      { scale: 0.97, duration: 0.12, ease: "power2.inOut" },
                      { scale: 1.04, duration: 0.12, ease: "power2.out" },
                      { scale: 1.00, duration: 0.10, ease: "power2.inOut" }
                    ],
                    overwrite: true
                  });
                }
              }
            );
          }
        });

        ScrollTrigger.refresh();
      };

      window.addEventListener("load", setup);
      window.addEventListener("resize", setup);
    })();

    // ===== Works: desktop horizontal pinned / mobile vertical =====
    const worksSection = document.querySelector(".works");
    const worksTrack = document.querySelector(".works-track");

    function setupWorksScroll() {
      ScrollTrigger.getAll().forEach(st => {
        if (st && st.vars && st.vars.id === "worksPin") st.kill();
      });
      gsap.killTweensOf(worksTrack);

      if (!worksSection || !worksTrack) return;

      const isDesktop = window.matchMedia("(min-width: 768px)").matches;

      if (!isDesktop) {
        worksTrack.style.transform = "none";
        worksSection.style.height = "auto";
        return;
      }

      const maxX = () => -(worksTrack.scrollWidth - window.innerWidth);

      gsap.to(worksTrack, {
        x: maxX,
        ease: "none",
        scrollTrigger: {
          id: "worksPin",
          trigger: worksSection,
          start: "top top",
          end: () => "+=" + (worksTrack.scrollWidth - window.innerWidth),
          scrub: true,
          pin: true,
          anticipatePin: 1,
          invalidateOnRefresh: true
        }
      });

      ScrollTrigger.refresh();
    }

    window.addEventListener("load", setupWorksScroll);
    window.addEventListener("resize", setupWorksScroll);

    // ===== Quote blur->clear =====
    const quoteLines = document.querySelectorAll(".quote-line");
    if (quoteLines.length) {
      gsap.to(quoteLines, {
        scrollTrigger: {
          trigger: ".quote",
          start: "top 80%",
          end: "top 30%",
          scrub: true
        },
        color: "rgba(255,255,255,0.92)",
        filter: "blur(0px)",
        y: 0
      });
    }

    // ===== Quote typing (enter view then type) =====
    (() => {
      const sec = document.querySelector(".quote");
      const l1 = document.querySelector(".quote-line--1");
      const l2 = document.querySelector(".quote-line--2");
      if (!sec || !l1 || !l2) return;

      const t1 = l1.dataset.text || "";
      const t2 = l2.dataset.text || "";

      l1.textContent = "";
      l2.textContent = "";

      let typed = false;

      const typeLine = (el, text, speed = 22) =>
        new Promise((resolve) => {
          let i = 0;
          const timer = setInterval(() => {
            i++;
            el.textContent = text.slice(0, i);
            if (i >= text.length) {
              clearInterval(timer);
              resolve();
            }
          }, speed);
        });

      const io = new IntersectionObserver(async (entries) => {
        const entry = entries[0];
        if (!entry || !entry.isIntersecting) return;
        if (typed) return;

        typed = true;
        await typeLine(l1, t1, 22);
        await typeLine(l2, t2, 22);
        io.disconnect();
      }, {
        threshold: 0.45,
        rootMargin: "0px 0px -10% 0px"
      });

      io.observe(sec);
    })();
  </script>

  <script>
    // ===== Vue Contact Form =====
    const { createApp } = Vue;

    createApp({
      data() {
        return {
          form: { email: "", phone: "", name: "", message: "" },
          msg: ""
        };
      },
      methods: {
        async send() {
          this.msg = "Sending...";
          try {
            const r = await fetch("/contact", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(this.form)
            });

            const result = await r.json();
            this.msg = result.message || "OK";

            if (result.ok) {
              this.form = { email: "", phone: "", name: "", message: "" };
              setTimeout(() => (this.msg = ""), 2000);
            }
          } catch (err) {
            this.msg = "Send failed: " + err;
          }
        }
      }
    }).mount("#app");
  </script>

</body>
</html>
